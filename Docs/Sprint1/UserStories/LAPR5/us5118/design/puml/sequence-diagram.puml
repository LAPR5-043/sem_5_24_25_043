@startuml


title US 5.1.18 - As a Doctor, I want to remove an operation reqRoutesition

skinparam classAttributeIconSize 0

skinparam class {
    LifeLineBorderColor DodgerBlue
    LifeLineBackgroundColor Route
    BackgroundColor LemonChiffon
    ArrowColor Brown
    BorderColor SaddleBrown
}

skinparam packageStyle rectangle

skinparam card {
    LifeLineBorderColor DodgerBlue
    LifeLineBackgroundColor Route
    BackgroundColor LemonChiffon
    ArrowColor Brown
    BorderColor SaddleBrown
}

actor "Doctor" as Doctor

participant "Route" as Route
participant "OperationRequestController" as ORC
participant "AuthService" as AS
participant "OperationRequestService" as ORS
participant "StaffService" as SV
participant "OperationRequestRepository" as ORR
participant "AppointmentRepository" as AR
participant "PlanningModuleService" as PMI


activate Doctor

Doctor -> Route: DELETE \n/api/operationRequests/{id}

activate Route

Route -> ORC: DeleteOperationRequest\n(OperationRequestID)

activate ORC

ORC -> AS: getAuthenticatedUserEmail(accessToken)

activate AS

AS --> ORC: email

deactivate AS

deactivate SV

ORC -> ORS: DeleteOperationRequestAsync(id, doctorEmail)

activate ORS

ORS -> SV: GetIdFromEmailAsync(doctorEmail)

activate SV

SV --> ORS: doctorID

deactivate SV

ORS -> ORR: GetByIdAsync(OperationRequestID)

activate ORR

ORR --> ORS: operationRequest

deactivate ORR

ORS -> ORS: checkIfDoctorIsTheCreatorOfOperationRequestAsync(doctorID, operationRequest)

activate ORS

deactivate ORS

ORS -> AR: CheckIfOperationIsScheduled(id)

activate AR

AR --> ORS: false

deactivate AR

ORS -> ORR: Remove(operationRequest)

activate ORR

ORR --> ORS: true

deactivate ORR

ORS -> PMI: NotifyOperationRequestDeleted(id)

activate PMI

PMI --> ORS:

deactivate PMI

ORS --> ORC: true

deactivate ORS

ORC --> Route: true

deactivate ORC

Route --> Doctor: Operation request removed successfully























@enduml